/*!
 * EditorWidget v1.0.0
 *
 * A plug-and-play CodeMirror 5.51.0 widget with an integrated console panel and debug utilities.
 *
 * Global API:
 *   window.EditorWidget = {
 *     mount: function(container, options) -> instance,
 *     unmount: function(instance),
 *     version: "1.0.0"
 *   }
 *
 * Instance API:
 *   instance.getValue()
 *   instance.setValue(code)
 *   instance.setMode(mode)
 *   instance.setTheme(theme)
 *   instance.setReadOnly(boolean)
 *   instance.setCaptureGlobalConsole(boolean)
 *   instance.getOption(name)
 *   instance.lint.enable()
 *   instance.lint.disable()
 *   instance.lint.toggle()
 *   instance.lint.isEnabled()
 *   instance.focus()
 *   instance.format()
 *   instance.dispose()
 *
 * Console controls:
 *   instance.console.clear()
 *   instance.console.copyToClipboard()
 *   instance.console.download(filename)
 *   instance.console.filter({ log:Boolean, info:Boolean, warn:Boolean, error:Boolean })
 *   instance.console.pause(Boolean)
 *   instance.console.setVisible(Boolean)
 *   instance.console.setCapture(Boolean)
 *
 * Debug toggles:
 *   instance.debug.enable()
 *   instance.debug.disable()
 *   instance.debug.mark(label)
 *   instance.debug.measure(labelStart, labelEnd)
 *   instance.debug.count(label)
 *   instance.debug.resetCounts()
 *   instance.debug.isEnabled()
 *
 * Mount Options (all optional):
 * {
 *   value: "\\n",
 *   mode: "javascript",
 *   readOnly: false,
 *   theme: "default",
 *   lineNumbers: true,
 *   lineWrapping: true,
 *   showConsole: true,
 *   wrapConsole: true,
 *   height: "400px",
 *   resizable: true,
 *   gutters: ["CodeMirror-linenumbers", "CodeMirror-foldgutter"],
 *   enableBasicAddons: true,
 *   enableFolding: true,
 *   enableSearch: true,
 *   captureGlobalConsole: true,
 *   debugEnabled: true,
 *   persist: false,
 *   persistKey: "default",
 *   persistEditorValue: true,
 *   showResourcePanel: true,
 *   resourcePanelWidth: '260px',
 *   resourcePanelTitle: 'Resources',
 *   resources: [{ label: 'Constants', items: [{ label: 'true', snippet: 'true' }] }],
 *   enableLint: false,
 *   lintOptions: null
 * }
 *
 * Resource configuration:
 *   resources: [{
 *     label: 'Category name',
 *     description: 'Optional helper text',
 *     items: [{ label: 'Snippet label', snippet: 'snippetToInsert();' }],
 *     groups: [{ label: 'Subgroup', items: [...] }]
 *   }]
 * Provide snippet text exactly as you would like it inserted into the editor.
 * Access the curated defaults via window.EditorWidget.defaults.resources.
 *
 * Linting (optional):
 *   Requires CodeMirror lint assets and JSHINT global.
 *   Include:
 *     <link rel="stylesheet" href=".../addon/lint/lint.css">
 *     <script src="https://cdnjs.cloudflare.com/ajax/libs/jshint/x.y.z/jshint.min.js"><\/script>
 *     <script src=".../addon/lint/lint.js"></script>
 *     <script src=".../addon/lint/javascript-lint.js"></script>
 */
!function(e,t){"function"==typeof define&&define.amd?define(function(){return t(e)}):"object"==typeof module&&module.exports?module.exports=t(e):e.EditorWidget=t(e)}("undefined"!=typeof self?self:this,function(e){"use strict";var t="ew::";var i=[{label:"Constants",description:"Frequently used literal values.",items:[{label:"true",snippet:"true"},{label:"false",snippet:"false"},{label:"null",snippet:"null"},{label:"undefined",snippet:"undefined"}]},{label:"Functions",description:"Reusable function templates.",items:[{label:"function handler() {}",snippet:"function handler(payload) {\n  // TODO\n}\n"},{label:"try / catch",snippet:"try {\n  \n} catch (error) {\n  console.error(error);\n}\n"}]},{label:"Operators",items:[{label:"===",snippet:" === "},{label:"!==",snippet:" !== "},{label:"&&",snippet:" && "},{label:"||",snippet:" || "}]},{label:"Parameters",description:"Payload helper snippets.",items:[{label:"payload.data",snippet:"payload.data"},{label:"payload.params",snippet:"payload.params"},{label:"payload.user",snippet:"payload.user"}]},{label:"Javascript Functions",groups:[{label:"Server",items:[{label:"httpGet()",snippet:"httpGet(url, headers);"},{label:"httpPost()",snippet:"httpPost(url, data, headers, enableCertCheck);"},{label:"httpPut()",snippet:"httpPut(url, data, headers);"},{label:"httpDelete()",snippet:"httpDelete(url, headers);"},{label:"sendNotification()",snippet:"sendNotification(channel, message);"},{label:"sendTransaction()",snippet:"sendTransaction(name, payload);"},{label:"getJSONString()",snippet:"JSON.stringify(object, null, 2);"}]}]}],n={value:"",mode:"javascript",readOnly:!1,theme:"default",lineNumbers:!0,lineWrapping:!0,showConsole:!0,wrapConsole:!0,height:"400px",resizable:!0,gutters:["CodeMirror-linenumbers","CodeMirror-foldgutter"],enableBasicAddons:!0,enableFolding:!0,enableSearch:!0,captureGlobalConsole:!0,debugEnabled:!0,persist:!1,persistKey:"default",persistEditorValue:!0,showResourcePanel:!0,resourcePanelWidth:"260px",resourcePanelTitle:"Resources",resources:i,enableLint:!1,lintOptions:null},o=0,s={};function r(e,t){var i;for(i in t)t.hasOwnProperty(i)&&(e[i]=t[i]);return e}function l(e){if(!e||!e.length)return[];for(var t=[],i=0;i<e.length;i++){var n=e[i]||{},o={label:n.label||"Category "+(i+1),description:n.description||"",items:[],groups:[]};if(n.items&&n.items.length&&(o.items=a(n.items)),n.groups&&n.groups.length){o.groups=[];for(var s=0;s<n.groups.length;s++){var r=n.groups[s]||{};o.groups.push({label:r.label||"Group "+(s+1),description:r.description||"",collapsed:!!r.collapsed,items:a(r.items)})}}t.push(o)}return t}function a(e){if(!e||!e.length)return[];for(var t=[],i=0;i<e.length;i++){var n=e[i];"string"==typeof n?t.push({label:n,snippet:n}):n&&"object"==typeof n&&t.push({label:n.label||"Item "+(i+1),snippet:"string"==typeof n.snippet?n.snippet:n.label||"",description:n.description||""})}return t}var u=void 0!==e&&e.localStorage&&function(){try{var i=t+"test";return e.localStorage.setItem(i,"1"),e.localStorage.removeItem(i),!0}catch(e){return!1}}();function p(i){if(!u)return null;try{var n=e.localStorage.getItem(t+i);return n?JSON.parse(n):null}catch(e){return null}}function c(i,n){if(u){var o,s=p(i)||{};for(o in n)n.hasOwnProperty(o)&&(s[o]=n[o]);try{e.localStorage.setItem(t+i,JSON.stringify(s))}catch(e){}}}function h(t,i,n){var o=e.document.createElement(t);return i&&(o.className=i),"string"==typeof n&&o.appendChild(e.document.createTextNode(n)),o}function d(e,t){e&&t&&(e.classList?e.classList.add(t):-1===(" "+e.className+" ").indexOf(" "+t+" ")&&(e.className+=" "+t))}function f(e,t){var i;e&&t&&(e.classList?e.classList.remove(t):e.className=null==(i=(" "+e.className+" ").replace(" "+t+" "," "))?"":"function"==typeof i.trim?i.trim():String(i).replace(/^\\s+|\\s+$/g,""))}function b(e,t,i){i?d(e,t):f(e,t)}function m(e){var t=function(e){return e<10?"0"+e:String(e)};return t(e.getHours())+":"+t(e.getMinutes())+":"+t(e.getSeconds())}function g(e,t){if(void 0===t&&(t=[]),null===e)return"null";var i=typeof e;if("string"===i)return e;if("number"===i||"boolean"===i)return String(e);if("undefined"===i)return"undefined";if("function"===i)return e.toString();if(e instanceof Error)return e.name+": "+e.message+(e.stack?"\n"+e.stack:"");if(-1!==t.indexOf(e))return"[Circular]";t.push(e);try{return JSON.stringify(e,function(e,i){if("object"==typeof i&&null!==i){if(-1!==t.indexOf(i))return"[Circular]";t.push(i)}return"function"==typeof i?i.toString():i instanceof Error?i.name+": "+i.message:i},2)}catch(t){return Object.prototype.toString.call(e)}finally{t.pop()}}function v(e){return"["+m(e.timestamp)+"] "+e.level.toUpperCase()+" "+e.args.join(" ")}function y(e){for(var t=[],i=0;i<e.length;i++)t.push(v(e[i]));return t.join("\n")}var C=function(){var t=!1,i={},n=[],o=["log","info","warn","error"];function s(t){return function(){var o=Array.prototype.slice.call(arguments);!function(e){for(var t=0;t<n.length;t++)if(n[t]&&n[t].callback)try{n[t].callback(e)}catch(e){}}({level:t,args:o,timestamp:new Date}),"function"==typeof i[t]&&i[t].apply(e.console,o)}}return{addListener:function(r){if("function"!=typeof r)return null;!function(){if(!t){var n;for(e.console||(e.console={}),n=0;n<o.length;n++){var r=o[n];i[r]=e.console[r]||function(){}}for(n=0;n<o.length;n++)e.console[o[n]]=s(o[n]);t=!0}}();var l={callback:r};return n.push(l),l},removeListener:function(s){if(s){for(var r=0;r<n.length;r++)if(n[r]===s){n.splice(r,1);break}!function(){if(t&&!(n.length>0)){for(var s=0;s<o.length;s++)i[o[s]]&&(e.console[o[s]]=i[o[s]]);t=!1}}()}}}}(),w=function(){var t=[],i=!1,n=null,o=null;function s(e,i){for(var n=0;n<t.length;n++)try{t[n](e,i)}catch(e){}}function r(e){s("error",{message:e.message||e.error&&e.error.message||"Unknown error",stack:e.error&&e.error.stack?e.error.stack:e.filename?e.filename+":"+e.lineno+":"+e.colno:"",error:e.error||null})}function l(e){var t=e.reason,i="Unhandled Promise rejection";t&&t.message?i+=": "+t.message:"string"==typeof t&&(i+=": "+t),s("unhandledrejection",{message:i,stack:t&&t.stack?t.stack:"",error:t||null})}return{addListener:function(a){"function"==typeof a&&(i||(i=!0,e.addEventListener?(e.addEventListener("error",r,!0),e.addEventListener("unhandledrejection",l,!0)):(n=e.onerror,e.onerror=function(){var e=Array.prototype.slice.call(arguments),t=e[0],i=e[1],o=e[2],r=e[3];return s("error",{message:t||"Unknown error",stack:i?i+":"+o+":"+r:"",error:e[4]||null}),"function"==typeof n&&n.apply(this,e)},o=e.onunhandledrejection,e.onunhandledrejection=function(e){return s("unhandledrejection",{message:"Unhandled Promise rejection",stack:"",error:e&&e.reason?e.reason:null}),"function"==typeof o&&o.apply(this,arguments)})),t.push(a))},removeListener:function(e){for(var i=t.length-1;i>=0;i--)t[i]===e&&t.splice(i,1)}}}();function E(e,t){if(!e||!e.ownerDocument)throw new Error("EditorWidget.mount: container element is required");this.id="ew-"+ ++o,this.options=t,this.container=e,this.document=e.ownerDocument,this.rootEl=null,this.editorWrap=null,this.consoleWrap=null,this.consoleEntriesEl=null,this.consoleState={filters:{log:!0,info:!0,warn:!0,error:!0},paused:!1,wrap:!!t.wrapConsole,visible:!1!==t.showConsole},this.consoleEntries=[],this.consoleListenerToken=null,this.pauseButton=null,this.wrapButton=null,this.consoleVisibilityButton=null,this.cm=null,this.cmChangeHandler=null,this.cmKeyDownHandler=null,this.splitRatio=.7,this.isDragging=!1,this.dragHandlers=null,this.keyHandlersBound=!1,this.keydownHandler=null,this.persistKey=t.persist?t.persistKey:null,this.debugEnabled=!1!==t.debugEnabled,this.debugMarks={},this.debugCounts={},this.pausedBuffer=[],this.errorOverlayEl=null,this.countBadgeEl=null,this.searchPanel=null,this.searchInput=null,this.originalChildren=[],this.publicAPI=null,this.resources=l(this.options.resources),this.options.resources=this.resources,this.resourcePanel=null,this.resourceTabs=[],this.resourceListEl=null,this.activeResourceIndex=0,this.lintAvailable=!1,this.lintEnabled=!1,this.lintButton=null,this.init()}return E.prototype.init=function(){this.captureOriginalChildren(),this.createLayout(),this.initEditor(),this.initConsole(),this.initDebug(),this.applyInitialPersistence(),this.bindGlobalHandlers()},E.prototype.captureOriginalChildren=function(){for(var e;this.container.firstChild;)e=this.container.removeChild(this.container.firstChild),this.originalChildren.push(e)},E.prototype.restoreOriginalChildren=function(){var e;for(e=0;e<this.originalChildren.length;e++)this.container.appendChild(this.originalChildren[e]);this.originalChildren=[]},E.prototype.createLayout=function(){var e=h("div","ew-root");e.setAttribute("data-ew-instance",this.id),e.style.height=this.options.height;var t=h("div","ew-layout"),i=h("div","ew-main"),n=h("div","ew-pane ew-editor-pane"),o=h("div","ew-editor-toolbar");o.setAttribute("role","toolbar"),o.setAttribute("aria-label","Editor controls");var s=h("button","ew-btn ew-btn-link","Search");s.type="button",s.onclick=this.openSearchPanel.bind(this),!1===this.options.enableSearch&&(s.disabled=!0,d(s,"ew-disabled")),o.appendChild(s);var r=h("button","ew-btn ew-btn-link","Format");r.type="button",r.onclick=this.format.bind(this),o.appendChild(r);var l=h("button","ew-btn ew-btn-primary","Run");if(l.type="button",l.onclick=this.runCode.bind(this),o.appendChild(l),!1!==this.options.enableLint){var a=h("button","ew-btn","Lint");a.type="button",a.setAttribute("aria-pressed","false"),a.disabled=!0,a.title="Linting assets not detected",a.onclick=this.toggleLint.bind(this),o.appendChild(a),this.lintButton=a}n.appendChild(o);var u=h("div","ew-editor-host");n.appendChild(u);var p=h("div","ew-splitter");p.setAttribute("role","separator"),p.setAttribute("aria-orientation","horizontal"),p.setAttribute("tabindex","0");var c=h("div","ew-pane ew-console-pane");this.buildConsoleToolbar(c);var f=h("div","ew-console-entries");f.setAttribute("role","log"),f.setAttribute("aria-live","polite"),this.consoleState.wrap&&d(f,"ew-wrap"),c.appendChild(f),i.appendChild(n),i.appendChild(p),i.appendChild(c),t.appendChild(i),!1!==this.options.showResourcePanel&&this.resources.length&&this.buildResourcePanel(t),e.appendChild(t);var b=h("div","ew-search-panel");d(b,"ew-hidden");var m=h("label","ew-search-label","Find:"),g=h("input","ew-search-input");g.type="text",g.setAttribute("placeholder","Ctrl/Cmd + F"),m.appendChild(g);var v=h("button","ew-btn","Next");v.type="button",v.onclick=this.findNext.bind(this);var y=h("button","ew-btn","Prev");y.type="button",y.onclick=this.findPrevious.bind(this);var C=h("button","ew-btn ew-btn-link","Close");C.type="button",C.onclick=this.closeSearchPanel.bind(this),b.appendChild(m),b.appendChild(v),b.appendChild(y),b.appendChild(C),e.appendChild(b);var w=h("div","ew-debug-counts");w.style.display="none",e.appendChild(w);var E=h("div","ew-error-overlay ew-hidden");E.setAttribute("role","alert");var L=h("div","ew-error-box"),S=h("div","ew-error-title","An error occurred"),k=h("pre","ew-error-message"),B=h("button","ew-btn ew-btn-primary","Dismiss");B.type="button",B.onclick=this.hideErrorOverlay.bind(this),L.appendChild(S),L.appendChild(k),L.appendChild(B),E.appendChild(L),e.appendChild(E),this.container.appendChild(e),this.rootEl=e,this.editorWrap=n,this.editorToolbar=o,this.editorHost=u,this.splitter=p,this.consoleWrap=c,this.consoleEntriesEl=f,this.errorOverlayEl=E,this.errorOverlayMessageEl=k,this.countBadgeEl=w,this.searchPanel=b,this.searchInput=g,this.applySplitRatio(this.splitRatio),this.setupSplitter()},E.prototype.buildConsoleToolbar=function(e){var t=h("div","ew-console-toolbar");t.setAttribute("role","toolbar"),t.setAttribute("aria-label","Console controls");var i,n=["log","info","warn","error"],o={log:"Log",info:"Info",warn:"Warn",error:"Error"};for(i=0;i<n.length;i++){var s=n[i],r=h("button","ew-btn ew-btn-toggle",o[s]);r.type="button",r.setAttribute("data-level",s),r.setAttribute("aria-label","Toggle "+o[s]),r.setAttribute("aria-pressed","true"),r.onclick=this.handleFilterToggle.bind(this,s),t.appendChild(r)}var l=h("button","ew-btn","Pause");l.type="button",l.setAttribute("aria-pressed","false"),l.onclick=this.togglePause.bind(this),l.className+=" ew-btn-toggle",this.pauseButton=l,t.appendChild(l);var a=h("button","ew-btn","Wrap");a.type="button",a.setAttribute("aria-pressed",this.consoleState.wrap?"true":"false"),a.onclick=this.toggleWrap.bind(this),a.className+=" ew-btn-toggle",this.wrapButton=a,b(a,"ew-off",!this.consoleState.wrap),t.appendChild(a);var u=h("button","ew-btn","Clear");u.type="button",u.onclick=this.clearConsole.bind(this),t.appendChild(u);var p=h("button","ew-btn","Copy");p.type="button",p.onclick=this.copyConsole.bind(this),t.appendChild(p);var c=h("button","ew-btn","Download");c.type="button",c.onclick=this.downloadConsole.bind(this),t.appendChild(c);var d=h("button","ew-btn","Toggle Console");d.type="button",d.onclick=this.toggleConsoleVisibility.bind(this),this.consoleVisibilityButton=d,d.setAttribute("aria-pressed",this.consoleState.visible?"true":"false"),b(d,"ew-off",!this.consoleState.visible),t.appendChild(d),e.appendChild(t)},E.prototype.buildResourcePanel=function(e){if(this.resources&&this.resources.length){var t=h("aside","ew-resource-panel");t.setAttribute("role","complementary"),t.style.width=this.options.resourcePanelWidth||"260px";var i=h("div","ew-resource-header","string"==typeof this.options.resourcePanelTitle?this.options.resourcePanelTitle:"Resources");t.appendChild(i);var n=h("div","ew-resource-tabs");n.setAttribute("role","tablist"),t.appendChild(n);var o=h("div","ew-resource-list");o.setAttribute("role","tabpanel"),o.id=this.id+"-resource-panel",t.appendChild(o),this.resourcePanel=t,this.resourceTabs=[],this.resourceListEl=o;for(var s=this,r=0;r<this.resources.length;r++)(function(e){var t=h("button","ew-resource-tab",s.resources[e].label);t.type="button",t.setAttribute("role","tab"),t.id=s.id+"-resource-tab-"+e,t.setAttribute("aria-selected","false"),t.setAttribute("aria-controls",o.id),t.onclick=function(){s.setActiveResourceCategory(e)},n.appendChild(t),s.resourceTabs.push(t)})(r);e.appendChild(t),this.setActiveResourceCategory(this.activeResourceIndex)}},E.prototype.setActiveResourceCategory=function(e){if(this.resources&&this.resources.length){(e<0||e>=this.resources.length)&&(e=0),this.activeResourceIndex=e;for(var t=0;t<this.resourceTabs.length;t++){var i=this.resourceTabs[t],n=t===e;b(i,"ew-active",n),i.setAttribute("aria-selected",n?"true":"false")}this.resourceListEl&&this.resourceTabs[e]&&this.resourceListEl.setAttribute("aria-labelledby",this.resourceTabs[e].id),this.renderResourceCategory(this.resources[e])}},E.prototype.renderResourceCategory=function(e){if(this.resourceListEl){for(;this.resourceListEl.firstChild;)this.resourceListEl.removeChild(this.resourceListEl.firstChild);if(e){if(e.description){var t=h("p","ew-resource-description",e.description);this.resourceListEl.appendChild(t)}var i=e.groups&&e.groups.length?e.groups:null;if(i)for(var n=0;n<i.length;n++)this.renderResourceGroup(i[n]);else{var o=h("div","ew-resource-items ew-resource-items--root");this.renderResourceItems(o,e.items),this.resourceListEl.appendChild(o)}}else this.resourceListEl.appendChild(h("div","ew-resource-empty","No resources configured."))}},E.prototype.renderResourceGroup=function(e){var t=h("div","ew-resource-group"),i=h("button","ew-resource-group-toggle",e.label||"Group");i.type="button",i.setAttribute("aria-expanded",e.collapsed?"false":"true"),t.appendChild(i);var n=h("div","ew-resource-items");if(t.appendChild(n),e.description){var o=h("p","ew-resource-group-desc",e.description);n.appendChild(o)}this.renderResourceItems(n,e.items),e.collapsed&&b(t,"ew-collapsed",!0);i.onclick=function(){var e=-1!==t.className.indexOf("ew-collapsed");b(t,"ew-collapsed",e=!e),i.setAttribute("aria-expanded",e?"false":"true")},this.resourceListEl.appendChild(t)},E.prototype.renderResourceItems=function(e,t){if(t&&t.length)for(var i=this,n=0;n<t.length;n++)(function(t){var n=h("button","ew-resource-item",t.label||t.snippet);n.type="button",t.description&&n.setAttribute("title",t.description),n.onclick=function(){i.insertResourceSnippet(t)},e.appendChild(n)})(t[n]);else e.appendChild(h("div","ew-resource-empty","No snippets available."))},E.prototype.insertResourceSnippet=function(e){if(e){var t="string"==typeof e.snippet?e.snippet:e.label||"";if(t)if(this.cm&&"function"==typeof this.cm.replaceSelection)this.cm.focus(),this.cm.getDoc&&"function"==typeof this.cm.getDoc?this.cm.getDoc().replaceSelection(t):this.cm.replaceSelection(t);else{var i=this.options.value||"";this.options.value=i+t}}},E.prototype.setupSplitter=function(){if(this.options.resizable){var e=this,t=function(t){if(e.isDragging){var i=e.rootEl.getBoundingClientRect(),n=(t.clientY-i.top)/i.height;n<.15?n=.15:n>.85&&(n=.85),e.applySplitRatio(n),e.persistSplitRatio()}},i=function(){e.isDragging&&(e.isDragging=!1,f(e.rootEl,"ew-resizing"),e.document.removeEventListener("mousemove",t),e.document.removeEventListener("mouseup",i))},n=function(n){n.preventDefault(),e.isDragging=!0,d(e.rootEl,"ew-resizing"),e.document.addEventListener("mousemove",t),e.document.addEventListener("mouseup",i)};this.splitter.addEventListener("mousedown",n),this.dragHandlers={onMouseDown:n,onMouseMove:t,onMouseUp:i}}else d(this.splitter,"ew-disabled")},E.prototype.applySplitRatio=function(e){this.splitRatio=e;var t=Math.max(.05,Math.min(.95,e)),i=1-t;this.editorWrap.style.flexBasis=100*t+"%",this.consoleWrap.style.flexBasis=100*i+"%",this.cm&&this.cm.refresh()},E.prototype.persistSplitRatio=function(){this.persistKey&&c(this.persistKey,{splitRatio:this.splitRatio})},E.prototype.initEditor=function(){var t=e.CodeMirror;if(t&&"function"==typeof t){var i=this,n={value:this.options.value||"",mode:this.options.mode||"javascript",theme:this.options.theme||"default",readOnly:!!this.options.readOnly,lineNumbers:!1!==this.options.lineNumbers,lineWrapping:!1!==this.options.lineWrapping,gutters:this.options.gutters||["CodeMirror-linenumbers","CodeMirror-foldgutter"]};this.options.enableBasicAddons&&(n.matchBrackets=!0,n.autoCloseBrackets=!0,n.styleActiveLine=!0),this.options.enableFolding&&(n.foldGutter=!0),this.cm=t(this.editorHost,n),this.cmChangeHandler=function(){i.persistKey&&i.options.persist&&!1!==i.options.persistEditorValue&&c(i.persistKey,{editorValue:i.cm.getValue()})},this.cm.on("change",this.cmChangeHandler),this.cmKeyDownHandler=this.handleEditorKeyDown.bind(this),this.cm.on("keydown",this.cmKeyDownHandler),this.initLint()}else{var o=h("div","ew-warning","CodeMirror 5.51.0 is required.");this.editorHost.appendChild(o)}},E.prototype.initConsole=function(){this.setCaptureGlobalConsole(!!this.options.captureGlobalConsole),this.publicAPI=this.createPublicAPI(),this.setConsoleVisible(this.consoleState.visible,!0)},E.prototype.initLint=function(){!1!==this.options.enableLint&&this.cm?(this.isLintEnvironmentReady()?(this.lintAvailable=!0,this.setLintActive(!0,!0)):(this.lintAvailable=!1,this.setLintActive(!1,!0)),this.updateLintButton()):this.updateLintButton()},E.prototype.isLintEnvironmentReady=function(){return!!(e.CodeMirror&&e.CodeMirror.lint&&e.CodeMirror.lint.javascript)},E.prototype.toggleLint=function(){!1!==this.options.enableLint&&this.lintAvailable&&this.setLintActive(!this.lintEnabled)},E.prototype.setLintActive=function(e,t){if(!this.cm||!this.lintAvailable)return this.lintEnabled=!1,this.cm&&this.cm.setOption("lint",!1),void(t||this.updateLintButton());if(this.lintEnabled=!!e,this.lintEnabled){this.ensureLintGutter();var i=this.options.lintOptions;i||(i={esversion:6}),this.cm.setOption("lint",i)}else this.cm.setOption("lint",!1);t||this.updateLintButton()},E.prototype.ensureLintGutter=function(){if(this.cm){var e=this.cm.getOption("gutters")||[];-1===e.indexOf("CodeMirror-lint-markers")&&(e=e.concat(["CodeMirror-lint-markers"]),this.cm.setOption("gutters",e))}},E.prototype.updateLintButton=function(){if(this.lintButton){if(!this.options.enableLint)return this.lintButton.disabled=!0,this.lintButton.title="Linting disabled via configuration",this.lintButton.textContent="Lint",void this.lintButton.setAttribute("aria-pressed","false");if(!this.lintAvailable)return this.lintButton.disabled=!0,this.lintButton.title="Load CodeMirror lint addons and JSHINT to enable linting",this.lintButton.setAttribute("aria-pressed","false"),void(this.lintButton.textContent="Lint");this.lintButton.disabled=!1,this.lintButton.title="Toggle real-time syntax checking",this.lintButton.setAttribute("aria-pressed",this.lintEnabled?"true":"false"),this.lintButton.textContent=this.lintEnabled?"Lint On":"Lint Off"}},E.prototype.initDebug=function(){var e=this;this.errorHandler=function(t,i){if(e.debugEnabled){var n="error"===t?"error":"warn";e.appendConsoleEntry(n,[i.message,i.stack||""]),e.showErrorOverlay(i.message,i.stack)}},w.addListener(this.errorHandler),this.updateDebugBadge()},E.prototype.applyInitialPersistence=function(){if(this.persistKey&&this.options.persist){var e=p(this.persistKey);e&&("number"==typeof e.splitRatio&&this.applySplitRatio(e.splitRatio),"boolean"==typeof e.consoleVisible&&this.setConsoleVisible(e.consoleVisible,!0),e.theme&&this.cm&&this.setTheme(e.theme),e.hasOwnProperty("editorValue")&&this.cm&&!1!==this.options.persistEditorValue&&this.cm.setValue(e.editorValue))}},E.prototype.bindGlobalHandlers=function(){var t=this;this.keydownHandler=function(i){if(/Mac|iPod|iPhone|iPad/.test(e.navigator&&e.navigator.platform)?i.metaKey:i.ctrlKey){var n=i.key||i.keyCode;"/"===n||191===n?(i.preventDefault(),t.toggleComment()):"b"===n||"B"===n||66===n?(i.preventDefault(),t.toggleConsoleVisibility()):"Enter"===n||13===n?(i.preventDefault(),t.runCode()):"f"!==n&&"F"!==n&&70!==n||(i.preventDefault(),t.openSearchPanel())}},this.rootEl.addEventListener("keydown",this.keydownHandler),this.keyHandlersBound=!0},E.prototype.handleEditorKeyDown=function(t,i){(/Mac|iPod|iPhone|iPad/.test(e.navigator&&e.navigator.platform)?i.metaKey:i.ctrlKey)&&("F"===i.key&&i.shiftKey||70===i.keyCode&&i.shiftKey)&&(i.preventDefault(),this.findPrevious())},E.prototype.toggleComment=function(){if(this.cm)if("function"==typeof this.cm.toggleComment)this.cm.toggleComment();else if(this.cm.execCommand)try{this.cm.execCommand("toggleComment")}catch(e){}},E.prototype.openSearchPanel=function(){this.options.enableSearch&&(f(this.searchPanel,"ew-hidden"),this.searchInput.focus())},E.prototype.closeSearchPanel=function(){d(this.searchPanel,"ew-hidden"),this.cm&&this.cm.focus()},E.prototype.findNext=function(){if(this.cm&&this.searchInput){var e=this.searchInput.value;if(e)if("function"==typeof this.cm.execCommand&&this.cm.getSearchCursor)try{var t=this.cm.getSearchCursor(e,this.cm.getCursor());t.findNext()||(t=this.cm.getSearchCursor(e,{line:0,ch:0})).findNext(),this.cm.setSelection(t.from(),t.to()),this.cm.scrollIntoView({from:t.from(),to:t.to()})}catch(e){}else if("function"==typeof this.cm.execCommand)try{this.cm.execCommand("findNext")}catch(e){}}},E.prototype.findPrevious=function(){if(this.cm&&this.searchInput){var e=this.searchInput.value;if(e)if("function"==typeof this.cm.execCommand&&this.cm.getSearchCursor)try{var t=this.cm.getSearchCursor(e,this.cm.getCursor());t.findPrevious()||(t=this.cm.getSearchCursor(e,{line:this.cm.lineCount()-1,ch:0})).findPrevious(),this.cm.setSelection(t.from(),t.to()),this.cm.scrollIntoView({from:t.from(),to:t.to()})}catch(e){}else if("function"==typeof this.cm.execCommand)try{this.cm.execCommand("findPrev")}catch(e){}}},E.prototype.runCode=function(){if(this.cm){var e=this.cm.getValue();try{var t=new Function(e)();void 0!==t&&this.appendConsoleEntry("info",["Result:",g(t)])}catch(e){this.appendConsoleEntry("error",[e.message,e.stack||""]),this.showErrorOverlay(e.message,e.stack||"")}}},E.prototype.handleFilterToggle=function(e){this.consoleState.filters[e]=!this.consoleState.filters[e],this.updateFilterButtons(),this.applyFilters()},E.prototype.togglePause=function(){if(this.consoleState.paused=!this.consoleState.paused,this.pauseButton&&(this.pauseButton.setAttribute("aria-pressed",this.consoleState.paused?"true":"false"),b(this.pauseButton,"ew-off",this.consoleState.paused)),!this.consoleState.paused&&this.pausedBuffer.length){for(var e=0;e<this.pausedBuffer.length;e++)this.appendConsoleEntry(this.pausedBuffer[e].level,this.pausedBuffer[e].args,this.pausedBuffer[e].timestamp);this.pausedBuffer=[]}},E.prototype.toggleWrap=function(){this.consoleState.wrap=!this.consoleState.wrap,this.wrapButton&&(this.wrapButton.setAttribute("aria-pressed",this.consoleState.wrap?"true":"false"),b(this.wrapButton,"ew-off",!this.consoleState.wrap)),b(this.consoleEntriesEl,"ew-wrap",this.consoleState.wrap)},E.prototype.clearConsole=function(){for(this.consoleEntries=[],this.pausedBuffer=[];this.consoleEntriesEl.firstChild;)this.consoleEntriesEl.removeChild(this.consoleEntriesEl.firstChild)},E.prototype.copyConsole=function(){var t=y(this.consoleEntries);if(t){var i=e.navigator;if(i&&i.clipboard&&i.clipboard.writeText)i.clipboard.writeText(t);else{var n=h("textarea","");n.value=t,n.setAttribute("readonly","readonly"),n.style.position="absolute",n.style.left="-10000px",this.rootEl.appendChild(n),n.select();try{this.document.execCommand("copy")}catch(e){}this.rootEl.removeChild(n)}}},E.prototype.downloadConsole=function(){this.downloadConsoleWithName("console-output.txt")},E.prototype.setConsoleVisible=function(e,t){var i="boolean"!=typeof e||e,n=this.consoleState.visible!==i;this.consoleState.visible=i,this.consoleWrap&&b(this.consoleWrap,"ew-hidden",!i),this.splitter&&b(this.splitter,"ew-hidden",!i),this.consoleVisibilityButton&&(this.consoleVisibilityButton.setAttribute("aria-pressed",i?"true":"false"),b(this.consoleVisibilityButton,"ew-off",!i)),n&&this.persistKey&&!t&&c(this.persistKey,{consoleVisible:i}),i?this.applySplitRatio(this.splitRatio):this.cm&&this.cm.refresh()},E.prototype.toggleConsoleVisibility=function(){this.setConsoleVisible(!this.consoleState.visible)},E.prototype.updateFilterButtons=function(){for(var e=this.consoleWrap.querySelectorAll("button[data-level]"),t=0;t<e.length;t++){var i=e[t],n=i.getAttribute("data-level"),o=this.consoleState.filters[n];i.setAttribute("aria-pressed",o?"true":"false"),o?f(i,"ew-off"):d(i,"ew-off")}},E.prototype.applyFilters=function(){for(var e=this.consoleEntriesEl.children,t=0;t<e.length;t++){var i=e[t],n=i.getAttribute("data-level");b(i,"ew-hidden",!!!this.consoleState.filters[n])}},E.prototype.handleConsoleEntry=function(e){this.consoleState.paused?this.pausedBuffer.push(e):this.appendConsoleEntry(e.level,e.args,e.timestamp)},E.prototype.appendConsoleEntry=function(e,t,i){t||(t=[]),i&&i instanceof Date||(i=new Date);for(var n=[],o=0;o<t.length;o++)n.push(g(t[o]));var s={level:e,args:n,timestamp:i};this.consoleEntries.push(s),this.consoleEntries.length>500&&(this.consoleEntries.shift(),this.consoleEntriesEl.firstChild&&this.consoleEntriesEl.removeChild(this.consoleEntriesEl.firstChild));var r=h("div","ew-console-entry");r.setAttribute("data-level",e),d(r,"ew-level-"+e);var l=h("div","ew-console-meta","["+m(i)+"] "+e.toUpperCase()),a=h("div","ew-console-body");this.consoleState.wrap&&d(a,"ew-wrap");for(var u=0;u<n.length;u++){var p=h("pre","ew-console-arg");p.textContent=n[u],a.appendChild(p)}r.appendChild(l),r.appendChild(a),this.consoleState.filters[e]||d(r,"ew-hidden"),this.consoleEntriesEl.appendChild(r),this.consoleEntriesEl.scrollTop=this.consoleEntriesEl.scrollHeight},E.prototype.createPublicAPI=function(){var e=this,t={getValue:function(){return e.cm?e.cm.getValue():""},setValue:function(t){e.cm&&e.cm.setValue(null==t?"":String(t))},setMode:function(t){e.setMode(t)},setTheme:function(t){e.setTheme(t)},setReadOnly:function(t){e.cm&&e.cm.setOption("readOnly",!!t)},setCaptureGlobalConsole:function(t){e.setCaptureGlobalConsole(t)},getOption:function(t){if(t)return Object.prototype.hasOwnProperty.call(e.options,t)?e.options[t]:void 0},focus:function(){e.cm&&e.cm.focus()},format:function(){e.format()},dispose:function(){e.dispose()},console:{clear:function(){e.clearConsole()},copyToClipboard:function(){e.copyConsole()},download:function(t){t?e.downloadConsoleWithName(t):e.downloadConsole()},filter:function(t){e.setConsoleFilters(t)},setVisible:function(t){e.setConsoleVisible(t)},setCapture:function(t){e.setCaptureGlobalConsole(t)},pause:function(t){"boolean"==typeof t?e.consoleState.paused!==t&&e.togglePause():e.togglePause()}},debug:{enable:function(){e.setDebugEnabled(!0)},disable:function(){e.setDebugEnabled(!1)},mark:function(t){return e.mark(t)},measure:function(t,i){return e.measure(t,i)},count:function(t){return e.count(t)},resetCounts:function(){e.resetCounts()},isEnabled:function(){return!!e.debugEnabled}},lint:{enable:function(){e.isLintEnvironmentReady()&&(e.lintAvailable=!0,e.setLintActive(!0))},disable:function(){e.setLintActive(!1)},toggle:function(){e.toggleLint()},isEnabled:function(){return!!e.lintEnabled&&!!e.lintAvailable}}};return t.__instance=e,t},E.prototype.format=function(){if(this.cm){var e=this.cm;e.operation(function(){for(var t=e.lineCount(),i=0;i<t;i++)e.indentLine(i,"smart")})}},E.prototype.downloadConsoleWithName=function(t){var i=y(this.consoleEntries);if(i){var n=t||"console-output.txt";if(e.Blob&&e.URL&&e.URL.createObjectURL){var o=new Blob([i],{type:"text/plain"}),s=e.URL.createObjectURL(o),r=h("a","");return r.style.display="none",r.href=s,r.download=n,this.rootEl.appendChild(r),r.click(),this.rootEl.removeChild(r),void setTimeout(function(){e.URL.revokeObjectURL(s)},0)}var l="data:text/plain;charset=utf-8,"+encodeURIComponent(i),a=h("a","");a.style.display="none",a.href=l,a.download=n,this.rootEl.appendChild(a),a.click(),this.rootEl.removeChild(a)}},E.prototype.setConsoleFilters=function(e){if(e){var t=!1;for(var i in this.consoleState.filters)if(this.consoleState.filters.hasOwnProperty(i)){var n="boolean"==typeof e[i]?e[i]:this.consoleState.filters[i];this.consoleState.filters[i]!==n&&(t=!0,this.consoleState.filters[i]=n)}t&&(this.updateFilterButtons(),this.applyFilters())}},E.prototype.setCaptureGlobalConsole=function(e){var t=!!e;t&&!this.consoleListenerToken?this.consoleListenerToken=C.addListener(this.handleConsoleEntry.bind(this)):!t&&this.consoleListenerToken&&(C.removeListener(this.consoleListenerToken),this.consoleListenerToken=null),this.options.captureGlobalConsole=t},E.prototype.setDebugEnabled=function(e){this.debugEnabled=!!e,this.debugEnabled?this.updateDebugBadge():(this.hideErrorOverlay(),this.countBadgeEl.textContent="",this.countBadgeEl.style.display="none")},E.prototype.mark=function(t){if(t){var i=e.performance&&e.performance.now?e.performance.now():(new Date).getTime();return this.debugMarks[t]=i,i}},E.prototype.measure=function(e,t){if(!e||!t)return null;var i=this.debugMarks[e],n=this.debugMarks[t];if("number"!=typeof i||"number"!=typeof n)return null;var o=n-i;return this.appendConsoleEntry("info",["Measurement",e+" -> "+t+": "+o.toFixed(2)+"ms"]),o},E.prototype.count=function(e){return e?(this.debugCounts[e]||(this.debugCounts[e]=0),this.debugCounts[e]+=1,this.updateDebugBadge(),this.debugCounts[e]):0},E.prototype.resetCounts=function(){this.debugCounts={},this.updateDebugBadge()},E.prototype.updateDebugBadge=function(){if(!this.debugEnabled)return this.countBadgeEl.textContent="",void(this.countBadgeEl.style.display="none");var e=[];for(var t in this.debugCounts)this.debugCounts.hasOwnProperty(t)&&e.push(t+": "+this.debugCounts[t]);0===e.length?(this.countBadgeEl.textContent="",this.countBadgeEl.style.display="none"):(this.countBadgeEl.textContent=e.join(" | "),this.countBadgeEl.style.display="block")},E.prototype.showErrorOverlay=function(e,t){this.debugEnabled&&(e||(e="Unknown error"),this.errorOverlayMessageEl.textContent=e+(t?"\n\n"+t:""),f(this.errorOverlayEl,"ew-hidden"))},E.prototype.hideErrorOverlay=function(){d(this.errorOverlayEl,"ew-hidden")},E.prototype.getValue=function(){return this.cm?this.cm.getValue():""},E.prototype.setValue=function(e){this.cm&&this.cm.setValue(e),this.options.value=e},E.prototype.setTheme=function(e){if(this.cm){var t=e||"default";this.cm.setOption("theme",t),this.options.theme=t,this.persistKey&&c(this.persistKey,{theme:t})}},E.prototype.setMode=function(e){var t=e||"javascript";this.cm&&this.cm.setOption("mode",t),this.options.mode=t},E.prototype.dispose=function(){if(this.setLintActive(!1,!0),this.setCaptureGlobalConsole(!1),this.errorHandler&&(w.removeListener(this.errorHandler),this.errorHandler=null),this.cm){this.cmChangeHandler&&"function"==typeof this.cm.off&&this.cm.off("change",this.cmChangeHandler),this.cmKeyDownHandler&&"function"==typeof this.cm.off&&this.cm.off("keydown",this.cmKeyDownHandler);var e=this.cm.getWrapperElement?this.cm.getWrapperElement():null;e&&e.parentNode&&e.parentNode.removeChild(e),this.cm=null,this.cmChangeHandler=null,this.cmKeyDownHandler=null}this.keyHandlersBound&&(this.rootEl.removeEventListener("keydown",this.keydownHandler),this.keyHandlersBound=!1),this.dragHandlers&&this.splitter&&(this.splitter.removeEventListener("mousedown",this.dragHandlers.onMouseDown),this.document.removeEventListener("mousemove",this.dragHandlers.onMouseMove),this.document.removeEventListener("mouseup",this.dragHandlers.onMouseUp),this.dragHandlers=null),this.rootEl&&this.rootEl.parentNode&&this.rootEl.parentNode.removeChild(this.rootEl),this.restoreOriginalChildren(),delete s[this.id],this.container.__editorWidget=null},{mount:function(e,t){var a=function(e){var t={};if(r(t,n),t.resources=l(n.resources),e){var o=e.resources;r(t,e),o&&(t.resources=l(o))}return t.resources&&t.resources.length||(t.resources=l(i)),t}(t);a.persist&&(a.persistKey&&"default"!==a.persistKey||(e&&e.getAttribute&&e.getAttribute("data-ew-key")?a.persistKey=String(e.getAttribute("data-ew-key")):e&&e.id?a.persistKey="element:"+e.id:a.persistKey="instance:"+(o+1)));var u=new E(e,a);return s[u.id]=u,e.__editorWidget=u,u.publicAPI},unmount:function(e){if(e){var t=e.__instance||null;t&&t.dispose()}},version:"1.0.0",defaults:{resources:l(i)}}});